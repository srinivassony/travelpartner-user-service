<!DOCTYPE html>
<html lang="en">

<head>
    <title>User profile - Travel-partner</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="#">
    <meta name="keywords"
        content="Admin , Responsive, Landing, Bootstrap, App, Template, Mobile, iOS, Android, apple, creative app">
    <meta name="author" content="#">

    <%- include('links'); %>
        <style>
            /* CSS for the upload icon */
            .image-container {
                position: relative;
                display: inline-block;
                display: block;
            }

            /* CSS for the image */
            .image-container img {
                max-width: 100%;
                height: auto;
            }

            /* CSS for the upload icon */
            .upload-icon {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                opacity: 0;
                transition: opacity 0.3s ease;
                cursor: pointer;
                font-size: 2em;
                /* Responsive font size */
            }

            .image-container:hover .upload-icon {
                opacity: 1;
            }

            .box {
                width: 150px;
                height: 150px;
                overflow: hidden;
                /* Ensures the image doesn't overflow the box */
                border: 2px solid rgba(46, 190, 226, 0.603);
                border-radius: 5%;
                overflow: hidden;
                /* Ensure the image doesn't overflow the box */
                position: relative;
                /* Required for absolute positioning of image */
            }

            .box img {
                width: 100%;
                /* Ensure the image fills the entire box horizontally */
                height: 100%;
                /* Ensure the image fills the entire box vertically */
                object-fit: cover;
                /* Ensure the image covers the entire box */
                position: absolute;
                /* Position the image relative to the box */
                top: 0;
                /* Align the image to the top */
                left: 0;
                /* Align the image to the left */
            }

            .upload-card {
                width: 600px;
                padding: 30px;
                margin: 0 auto;
                background-color: #f5f5f5;
            }

            .imagePreview {
                width: 38px;
                height: 38px;
                border-radius: 4px;
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;
                margin-right: 15px;
            }

            .file-upload {
                display: flex;
                align-items: center;
                padding: 15px;
                box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.12);
                margin-bottom: 15px;
                position: relative;
                border-radius: 4px;
                background-color: #fff;
            }

            .file-select {
                position: relative;
                overflow: hidden;
                display: flex;
                align-items: center;
            }


            .file-select-name {
                margin-left: 15px;
            }

            .file-select input[type=file] {
                position: absolute;
                left: 0;
                top: 0;
                opacity: 0;
                width: 100%;
                height: 100%;
            }

            .file-remove {
                margin-left: 15px;
                position: absolute;
                right: 15px;
                top: 20px;
            }

            #imageContainer {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }

            /* Style for each image */
            #imageContainer img {
                width: 270px;
                /* Adjust the width as needed */
                height: auto;
                /* Maintain aspect ratio */
                margin: 10px;
                /* Add space between images */
                cursor: pointer;
                /* Show pointer cursor */
            }

            /* Modal styles */
            .modal {
                display: none;
                /* Hidden by default */
                position: fixed;
                /* Position the modal */
                z-index: 1000;
                /* Ensure modal is above other content */
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                /* Enable scrolling if needed */
                background-color: rgba(0, 0, 0, 0.8);
                /* Black background with opacity */
            }

            /* Modal content */
            .modal-content {
                margin: 10% auto;
                /* Center modal on screen */
                width: 600px; /* Adjust the width and height according to your container */
                height: 500px;    
                /* Height of modal content (40% of viewport height) */
                position: relative;
                text-align: center;
                color: #fff;
                /* Text color */
                overflow: hidden;
                /* Hide overflow content */
            }

            /* Close button */
            .close {
                position: absolute;
                top: 10px;
                right: 20px;
                font-size: 30px;
                color: #fff;
                cursor: pointer;
            }

            /* Image inside modal */
            .modal-content img {
                width: 100%;
                height: 100%;
            }

            /* Navigation buttons */
            .nav-button {
                background-color: rgba(255, 255, 255, 0.5);
                /* Semi-transparent white */
                color: #000;
                /* Text color */
                border: none;
                padding: 10px 20px;
                margin: 10px;
                cursor: pointer;
                border-radius: 5px;
                position: absolute;
                bottom: 10px;
            }

            /* Style for Previous button */
            #prevButton {
                left: 20px;
                /* Position to the left */
            }

            /* Style for Next button */
            #nextButton {
                right: 20px;
                /* Position to the right */
            }
        </style>
</head>

<body>

    <%- include('loader'); %>

        <div id="pcoded" class="pcoded">
            <div class="pcoded-overlay-box"></div>
            <div class="pcoded-container navbar-wrapper">
                <%- include('topNav'); %>
                    <div class="pcoded-main-container">
                        <div class="pcoded-wrapper">
                            <%- include('sideNav'); %>
                                <div class="pcoded-content">
                                    <div class="pcoded-inner-content">

                                        <div class="main-body">
                                            <div class="page-wrapper">

                                                <div class="page-header">
                                                    <div class="row align-items-end">
                                                        <div class="col-lg-4">
                                                            <div class="page-header-title">
                                                                <div class="d-inline">
                                                                    <h4>User Profile</h4>
                                                                    <span>User profile details</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-4">
                                                            <div class="page-header-title">
                                                                <div class="d-inline">
                                                                    <% if (errorMessage) { %>
                                                                        <span style="color: red;font-weight:bold;">
                                                                            <%= errorMessage %>
                                                                        </span>
                                                                        <%} else if(sucessMessage){ %>
                                                                            <span
                                                                                style="color: green;font-weight:bold;">
                                                                                <%= sucessMessage %>
                                                                            </span>
                                                                            <%}%>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-4">
                                                            <div class="page-header-breadcrumb">
                                                                <ul class="breadcrumb-title">
                                                                    <li class="breadcrumb-item" style="float: left;">
                                                                        <a href="/"> <i class="feather icon-home"></i>
                                                                        </a>
                                                                    </li>
                                                                    <li class="breadcrumb-item" style="float: left;"><a
                                                                            href="/user-profile">User Profile</a>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="page-body">

                                                    <div class="row">
                                                        <div class="col-lg-12">
                                                            <div class="cover-profile">
                                                                <div class="profile-bg-img">
                                                                    <img class="profile-bg-img img-fluid"
                                                                        src="../images/bg-img1.jpg" alt="bg-img">
                                                                    <div class="card-block user-info">
                                                                        <div class="col-md-12">
                                                                            <form>
                                                                                <div class="media-left image-container">
                                                                                    <div class="box">

                                                                                        <a href="#"
                                                                                            class="profile-image">
                                                                                            <img class="user-img img-radius"
                                                                                                id="myImage" src="#"
                                                                                                alt="user-img">

                                                                                        </a>
                                                                                        <label for="fileInput"
                                                                                            class="upload-icon"><i
                                                                                                class="fa fa-camera"></i></label>

                                                                                        <input type="file"
                                                                                            id="fileInput"
                                                                                            accept="image/*"
                                                                                            style="display: none;"
                                                                                            onchange="handleFileSelect(event)">

                                                                                    </div>
                                                                                </div>
                                                                                <div class="media-body row">
                                                                                    <div class="col-lg-12">
                                                                                        <div class="user-title">
                                                                                            <h2 id="userName"></h2>
                                                                                            <span
                                                                                                class="text-white"></span>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div>
                                                                                        <div
                                                                                            class="pull-right cover-btn">
                                                                                            <button type="button"
                                                                                                class="btn btn-primary m-r-10 m-b-5"><i
                                                                                                    class="icofont icofont-plus"></i>
                                                                                                Follow</button>

                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </form>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-lg-12">

                                                            <div class="tab-header card">
                                                                <ul class="nav nav-tabs md-tabs tab-timeline"
                                                                    role="tablist" id="mytab">
                                                                    <li class="nav-item">
                                                                        <a class="nav-link active" data-toggle="tab"
                                                                            href="#personal" role="tab">Personal
                                                                            Info</a>
                                                                        <div class="slide"></div>
                                                                    </li>
                                                                    <li class="nav-item">
                                                                        <a class="nav-link" data-toggle="tab"
                                                                            href="#uploadImage" role="tab">Upload
                                                                            Images</a>
                                                                        <div class="slide"></div>
                                                                    </li>

                                                                    <li class="nav-item">
                                                                        <a class="nav-link" data-toggle="tab"
                                                                            href="#gallery" role="tab">User gallery</a>
                                                                        <div class="slide"></div>
                                                                    </li>

                                                                </ul>
                                                            </div>


                                                            <div class="tab-content">

                                                                <!-- user-profile -->

                                                                <div class="tab-pane active" id="personal"
                                                                    role="tabpanel">

                                                                    <div class="card">
                                                                        <div class="card-header">
                                                                            <h5 class="card-header-text">About Me</h5>

                                                                            <button id="edit-btn" type="button"
                                                                                class="btn btn-sm btn-primary waves-effect waves-light f-right">
                                                                                <i class="icofont icofont-edit"></i>
                                                                            </button>
                                                                        </div>
                                                                        <div class="card-block">
                                                                            <div class="view-info">
                                                                                <div class="row">
                                                                                    <div class="col-lg-12">
                                                                                        <div class="general-info">
                                                                                            <div class="row">
                                                                                                <div
                                                                                                    class="col-lg-12 col-xl-6">
                                                                                                    <div
                                                                                                        class="table-responsive">
                                                                                                        <table
                                                                                                            class="table m-0">
                                                                                                            <tbody>
                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Full
                                                                                                                        Name
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="name">

                                                                                                                    </td>
                                                                                                                </tr>

                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Birth
                                                                                                                        Date
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="dob">
                                                                                                                    </td>
                                                                                                                </tr>

                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Country
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="country">
                                                                                                                    </td>
                                                                                                                </tr>
                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Gender
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="gender">
                                                                                                                    </td>
                                                                                                                </tr>
                                                                                                            </tbody>
                                                                                                        </table>
                                                                                                    </div>
                                                                                                </div>

                                                                                                <div
                                                                                                    class="col-lg-12 col-xl-6">
                                                                                                    <div
                                                                                                        class="table-responsive">
                                                                                                        <table
                                                                                                            class="table">
                                                                                                            <tbody>
                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Email
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="emailInfo">
                                                                                                                    </td>
                                                                                                                </tr>
                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        Mobile
                                                                                                                        Number
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="phone">
                                                                                                                    </td>
                                                                                                                </tr>

                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">
                                                                                                                        State
                                                                                                                    </th>
                                                                                                                    <td
                                                                                                                        id="state">
                                                                                                                    </td>
                                                                                                                </tr>
                                                                                                                <tr>
                                                                                                                    <th
                                                                                                                        scope="row">

                                                                                                                    </th>
                                                                                                                    <td>
                                                                                                                    </td>
                                                                                                                </tr>

                                                                                                            </tbody>
                                                                                                        </table>
                                                                                                    </div>
                                                                                                </div>

                                                                                            </div>

                                                                                        </div>

                                                                                    </div>

                                                                                </div>

                                                                            </div>

                                                                            <div class="edit-info">
                                                                                <div class="row">
                                                                                    <div class="col-lg-12">
                                                                                        <div class="general-info">

                                                                                            <form
                                                                                                action="/api/update/user"
                                                                                                method="post"
                                                                                                enctype="application/x-www-form-urlencoded"
                                                                                                name="myUpdateForm"
                                                                                                onsubmit="return validateUpdateForm()">
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">Full
                                                                                                        Name
                                                                                                    </label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="text"
                                                                                                            class="form-control"
                                                                                                            name="userName"
                                                                                                            id="editName">
                                                                                                        <span
                                                                                                            id="errorName"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">Email</label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="email"
                                                                                                            class="form-control"
                                                                                                            id="editEmailInfo"
                                                                                                            name="emailInfo">
                                                                                                        <span
                                                                                                            id="errorEmail"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">Mobile
                                                                                                        Number
                                                                                                    </label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="text"
                                                                                                            class="form-control"
                                                                                                            id="editPhone"
                                                                                                            name="phone">
                                                                                                        <span
                                                                                                            id="errorPhone"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">dob</label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="date"
                                                                                                            class="form-control"
                                                                                                            id="editDob"
                                                                                                            name="dob">
                                                                                                        <span
                                                                                                            id="errorDob"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">Country
                                                                                                    </label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="text"
                                                                                                            class="form-control"
                                                                                                            id="editCountry"
                                                                                                            name="country">
                                                                                                        <span
                                                                                                            id="errorCountry"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div
                                                                                                    class="form-group row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">State
                                                                                                    </label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="text"
                                                                                                            class="form-control"
                                                                                                            id="editState"
                                                                                                            name="state">
                                                                                                        <span
                                                                                                            id="errorState"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>
                                                                                                <div class="row">
                                                                                                    <label
                                                                                                        class="col-sm-2 col-form-label">Gender
                                                                                                    </label>
                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <div
                                                                                                            class="form-check form-check-inline">
                                                                                                            <label
                                                                                                                class="form-check-label">
                                                                                                                <input
                                                                                                                    class="form-check-input"
                                                                                                                    type="radio"
                                                                                                                    name="gender"
                                                                                                                    id="editGender"
                                                                                                                    value="male">
                                                                                                                Male
                                                                                                            </label>
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="form-check form-check-inline">
                                                                                                            <label
                                                                                                                class="form-check-label">
                                                                                                                <input
                                                                                                                    class="form-check-input"
                                                                                                                    type="radio"
                                                                                                                    name="gender"
                                                                                                                    id="editGender"
                                                                                                                    value="female">
                                                                                                                Female
                                                                                                            </label>
                                                                                                        </div>
                                                                                                        <span
                                                                                                            id="errorGender"
                                                                                                            style="color: red;"></span>
                                                                                                    </div>
                                                                                                </div>

                                                                                                <div
                                                                                                    class="form-group row">

                                                                                                    <div
                                                                                                        class="col-sm-10">
                                                                                                        <input
                                                                                                            type="hidden"
                                                                                                            class="form-control"
                                                                                                            id="uuid"
                                                                                                            name="userId"
                                                                                                            value="<%= id %>">

                                                                                                    </div>
                                                                                                </div>

                                                                                                <div
                                                                                                    class="text-center">
                                                                                                    <button
                                                                                                        type="submit"
                                                                                                        class="btn btn-primary waves-effect waves-light m-r-20">Save</button>
                                                                                                    <a href="#!"
                                                                                                        id="edit-cancel"
                                                                                                        class="btn btn-default waves-effect">Cancel</a>
                                                                                                </div>

                                                                                            </form>
                                                                                        </div>

                                                                                    </div>

                                                                                </div>

                                                                            </div>

                                                                        </div>

                                                                    </div>
                                                                </div>

                                                                <!-- upload file -->

                                                                <div class="tab-pane" id="uploadImage" role="tabpanel">

                                                                    <div class="card">
                                                                        <div class="card-header">
                                                                            <h5 class="card-header-text">Upload Image
                                                                            </h5>
                                                                        </div>
                                                                        <div class="card-block">

                                                                            <div class="j-wrapper j-wrapper-640">
                                                                                <form action="/upload/images"
                                                                                    method="post" class="j-pro"
                                                                                    id="j-pro" enctype="multipart/form-data"
                                                                                    >
                                                                                    <div class="j-content">

                                                                                        <div
                                                                                            class="j-divider j-gap-bottom-25">
                                                                                        </div>

                                                                                        <div class="j-unit">
                                                                                            <div
                                                                                                class="j-input j-append-big-btn">
                                                                                                <label
                                                                                                    class="j-icon-left"
                                                                                                    for="file_input">
                                                                                                    <i
                                                                                                        class="icofont icofont-download"></i>
                                                                                                </label>
                                                                                                <div
                                                                                                    class="j-file-button">
                                                                                                    Browse
                                                                                                    <input type="file"
                                                                                                        name="file_name"
                                                                                                        id="fileUpload"
                                                                                                        onchange="validateFile()">
                                                                                                </div>
                                                                                                <input type="text"
                                                                                                    id="file_input"
                                                                                                    readonly
                                                                                                    placeholder="no file selected" >
                                                                                                    <input type="hidden" name="userId" value="<%= id %>">
                                                                                                    <input type="hidden" name="uuid" value="<%= uuid %>">
                                                                                                <span
                                                                                                    class="j-hint">Only:
                                                                                                    jpg / png,
                                                                                                    less 1Mb</span>

                                                                                                    <span
                                                                                                    class="j-hint" id="fileError" style="color: red;font-weight:bold;"></span>

                                                                                            </div>
                                                                                        </div>


                                                                                        <div class="j-response"></div>

                                                                                    </div>

                                                                                    <div class="j-footer">
                                                                                        <button type="submit"
                                                                                            class="btn btn-primary" id="submitButton" disabled>Send</button>
                                                                                        <button type="reset"
                                                                                            class="btn btn-default m-r-20">Reset</button>
                                                                                    </div>

                                                                                </form>
                                                                            </div>

                                                                        </div>
                                                                    </div>


                                                                </div>

                                                                <!-- gallery Images -->
                                                                <div class="tab-pane" id="gallery" role="tabpanel">
                                                                    <div class="page-body gallery-page">
                                                                        <div class="row">

                                                                            <div class="col-sm-12">

                                                                                <div class="card">
                                                                                    <div class="card-header">
                                                                                        <h5>User Gallery</h5>
                                                                                    </div>
                                                                                    <div class="card-block">
                                                                                        <div class="row">
                                                                                            <div class="col-lg-12">

                                                                                                <div
                                                                                                    id="imageContainer">

                                                                                                </div>
                                                                                                <div id="imageModal"
                                                                                                    class="modal">
                                                                                                    <div
                                                                                                        class="modal-content">
                                                                                                        <span
                                                                                                            class="close">&times;</span>
                                                                                                        <img id="modalImage"
                                                                                                            src=""
                                                                                                            alt="Modal Image">
                                                                                                        <!-- Navigation buttons -->
                                                                                                        <button
                                                                                                            class="nav-button"
                                                                                                            id="prevButton">Previous</button>
                                                                                                        <button
                                                                                                            class="nav-button"
                                                                                                            id="nextButton">Next</button>
                                                                                                    </div>

                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>

                                                                                </div>


                                                                            </div>
                                                                        </div>


                                                                    </div>


                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div id="styleSelector">
                                        </div>
                                    </div>
                                </div>
                        </div>
                    </div>
            </div>
        </div>


        <%- include('scripts'); %>
            <script>
                function handleFileSelect(event)
                {
                    const file = event.target.files[0];
                    console.log('file', file)
                    if (!file)
                    {
                        alert('No file selected.');
                        return;
                    }
                    else
                    {
                        const reader = new FileReader();

                        reader.onload = function (e)
                        {
                            const imagePreview = document.getElementById('myImage');
                            imagePreview.src = e.target.result;
                            imagePreview.classList.add('selected'); // Add 'selected' class to the uploaded image
                        };

                        reader.readAsDataURL(file);
                    }

                    document.querySelector('.upload-icon').addEventListener('click', function ()
                    {
                        document.getElementById('fileInput').click();
                    });

                    const userId = "<%= id %>";
                    const uuid = "<%= uuid %>";
                    console.log('userId', userId)
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('userId', userId);
                    formData.append('uuid', uuid);

                    fetch('/profile/pic/upload', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response =>
                        {
                            if (response.ok)
                            {
                                return response.json();
                            }
                            throw new Error('Network response was not ok.');
                        })
                        .then(data =>
                        {
                            console.log(data); // Handle API response data here

                            if (data && data.status == 0)
                            {
                                alert('There was an error to upload the profile Picture');
                            }
                            else if (data && data.status == 1)
                            {
                                alert('File uploaded successfully.');
                            }

                        })
                        .catch(error =>
                        {
                            console.error('There was a problem with the fetch operation:', error);
                            alert('Error uploading file. Please try again.');
                        });
                }

            </script>

            <script>
                const phoneInput = document.getElementById('editPhone');

                phoneInput.addEventListener('input', function ()
                {
                    // Remove any non-digit characters
                    let phoneNumber = phoneInput.value.replace(/\D/g, '');

                    // Limit to 10 digits
                    phoneNumber = phoneNumber.slice(0, 10);

                    // Update the input value
                    phoneInput.value = phoneNumber;
                });
            </script>

            <script>

                function validateUpdateForm() 
                {
                    let name = document.forms["myUpdateForm"]["editName"].value;
                    let email = document.forms["myUpdateForm"]["editEmailInfo"].value;
                    let phone = document.forms["myUpdateForm"]["editPhone"].value;


                    let phoneValidation = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
                    let emailValidation = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

                    if (!name) 
                    {
                        document.getElementById('errorName').innerHTML = "userName is required.";
                        return false;
                    }
                    else if (name.toString().length < 2) 
                    {
                        document.getElementById('errorName').innerHTML = "User name minimum character limit is 2";
                        return false;
                    }
                    else if (name.toString().length > 30) 
                    {
                        document.getElementById('errorName').innerHTML = "userName maximum character limit is 30.";
                        return false;
                    }

                    if (!email)
                    {
                        document.getElementById('errorEmail').innerHTML = "Email is required.";
                        return false;
                    }
                    else if (email && !(email.match(emailValidation)))
                    {
                        document.getElementById('errorEmail').innerHTML = "Invalid email address";
                        return false;
                    }
                    else if (email && email.toString().length > 50)
                    {
                        document.getElementById('errorEmail').innerHTML = "Email maximum character limit is 50.";
                        return false;
                    }

                    if (phone && !(phone.match(phoneValidation)))
                    {
                        document.getElementById('errorPhone').innerHTML = "Invalid phone address";
                        return false;
                    }

                    return true;
                }

            </script>

            <script>
                document.addEventListener("DOMContentLoaded", function ()
                {
                    // Prepare data to be sent in the request body
                    var requestData = {
                        id: "<%= id %>" // Example user ID, replace with your actual parameter
                    };
                    console.log('requestData', requestData)
                    // Fetch user data from the backend when the page loads
                    fetch('/api/user/id', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    })
                        .then(response =>
                        {
                            if (response.ok)
                            {
                                return response.json();
                            }
                            throw new Error('Network response was not ok.');
                        })
                        .then(data =>
                        {
                            // Populate input boxes with fetched data
                            let user = data && data.userDetails ? data.userDetails : null;
                            let image = user && user.image ? user.image : null;
                            let galleryImages = user && user.gallerys ? user.gallerys : [];
                            const modal = document.getElementById('imageModal');
                            const modalImage = document.getElementById('modalImage');
                            let currentImageIndex = 0;
                            let gallerys = [];

                            console.log('galleryImages', galleryImages)

                            document.getElementById('name').textContent = user.userName;
                            document.getElementById('editName').value = user.userName;

                            document.getElementById('emailInfo').textContent = user.email;
                            document.getElementById('editEmailInfo').value = user.email;

                            document.getElementById('phone').textContent = user.phone;
                            document.getElementById('editPhone').value = user.phone;

                            document.getElementById('dob').textContent = user.dob;
                            document.getElementById('editDob').value = user.dob;

                            document.getElementById('country').textContent = user.country;
                            document.getElementById('editCountry').value = user.country;

                            document.getElementById('state').textContent = user.state;
                            document.getElementById('editState').value = user.state;

                            document.getElementById('gender').textContent = user.gender;

                            if (user.gender === 'male') 
                            {
                                document.getElementById('editGender').checked = true;
                            }
                            else if (user.gender === 'female') 
                            {
                                document.getElementById('editGender').checked = true;
                            }

                            if (image)
                            {
                                const uploadedImage = document.getElementById('myImage');
                                uploadedImage.src = '../images/uploads/' + image.profilePicId + '/' + image.profilePicName;
                                uploadedImage.style.display = 'block'; // Show the image element
                            }
                            else
                            {
                                const uploadedImage = document.getElementById('myImage');
                                uploadedImage.src = `../images/human.png`;
                                uploadedImage.style.display = 'block'; // Show the image element
                            }

                            let userName = document.getElementById('userName');
                            userName.textContent = user.userName;

                            if (galleryImages && galleryImages.length > 0)
                            {
                                const container = document.getElementById('imageContainer');

                                // Clear existing images in the container
                                container.innerHTML = '';

                                // Loop through the array and create img elements
                                galleryImages.forEach((imageUrl, index) =>
                                {

                                    gallerys.push('../gallery/' + imageUrl.imageId + '/' + imageUrl.fileName);

                                });

                                gallerys.forEach((imageUrl, index) =>
                                {
                                    const img = document.createElement('img');
                                    img.src = imageUrl
                                    img.className = "img-fluid img-thumbnail";
                                    img.alt = 'Image';
                                    img.addEventListener('click', () => openModal(index));
                                    container.appendChild(img);

                                });



                                console.log('gallerys', gallerys)
                                // Open the modal with the selected image
                                function openModal(index) 
                                {
                                    currentImageIndex = index;
                                    modalImage.src = gallerys[currentImageIndex];
                                    modal.style.display = 'block';

                                    // Close modal when close button or outside modal is clicked
                                    const closeBtn = document.querySelector('.close');
                                    closeBtn.onclick = closeModal;
                                    window.onclick = function (event) 
                                    {
                                        if (event.target === modal) 
                                        {
                                            closeModal();
                                        }
                                    };

                                    // Update navigation buttons visibility

                                    updateNavButtons();
                                }

                                // Function to close the modal
                                function closeModal() 
                                {
                                    modal.style.display = 'none';
                                }
                                // Function to update navigation buttons visibility
                                function updateNavButtons() 
                                {
                                    const prevBtn = document.getElementById('prevButton');
                                    const nextBtn = document.getElementById('nextButton');

                                    prevBtn.style.display = currentImageIndex > 0 ? 'block' : 'none';
                                    nextBtn.style.display = currentImageIndex < gallerys.length - 1 ? 'block' : 'none';
                                }

                                // Event listeners for navigation buttons
                                document.getElementById('prevButton').addEventListener('click', () => 
                                {
                                    if (currentImageIndex > 0) 
                                    {
                                        currentImageIndex--;
                                        modalImage.src = gallerys[currentImageIndex];
                                        updateNavButtons();
                                    }
                                });

                                document.getElementById('nextButton').addEventListener('click', () => 
                                {
                                    if (currentImageIndex < gallerys.length - 1) 
                                    {
                                        currentImageIndex++;
                                        modalImage.src = gallerys[currentImageIndex];
                                        updateNavButtons();
                                    }
                                });

                            }

                        })
                        .catch(error =>
                        {
                            console.error('Error fetching user data:', error);
                        });

                });
            </script>

            <script>
                function validateFile()
                {
                    const fileInput = document.getElementById('fileUpload');
                    const fileError = document.getElementById('fileError');
                    document.getElementById('file_input').value = fileInput.value;
                    const allowedExtensions = /(\.png|\.jpg|\.jpeg)$/i;
                    const maxFileSizeMB = 1; // Maximum file size in megabytes

                    const file = fileInput.files[0];
                    const fileSizeMB = file.size / (1024 * 1024); // Calculate file size in megabytes

                    if (!file || !allowedExtensions.exec(file.name))
                    {
                        fileError.textContent = 'Please select a valid PNG or JPG file.';
                        fileInput.value = ''; // Clear the file input
                        return false;
                    } else if (fileSizeMB > maxFileSizeMB)
                    {
                        fileError.textContent = 'File size should not exceed 1MB.';
                        fileInput.value = ''; // Clear the file input
                        return false;
                    } else
                    {
                        fileError.textContent = '';
                        document.getElementById('submitButton').disabled = false;
                        return true;
                    }
                }
            </script>
</body>

</html>